<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Add Money</title>
    <style>
        :root { --green: #00b894; --light-green: #e6f7f0; --blue: #4a90e2; }
        body {
            font-family: Arial, sans-serif;
            background: #fff;
            margin: 0;
            padding: 0;
            -webkit-font-smoothing:antialiased;
        }
        /* Header */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            font-size: 16px;
            border-bottom: 1px solid #f0f0f0;
        }
        .header a { text-decoration:none; color:#000; }
        .header .continue { color: var(--green); font-weight:700; cursor: pointer; } 
        /* Form container */
        .container { padding: 15px; max-width: 540px; margin: 0 auto; box-sizing:border-box; }
        .form-group { margin-bottom: 20px; }
        label { display:block; font-weight:700; margin-bottom:6px; }
        input[type="text"] {
            width:100%; height:55px; border:2px solid var(--green);
            border-radius:12px; padding:0 15px; font-size:14px;
            box-sizing:border-box; outline:none; color:#333; background:#fff;
            display:flex; align-items:center;
        }
        input::placeholder { color:#bdbdbd; }
        /* ===== Custom bank dropdown with icons (omitted for brevity) ===== */
        .custom-select { position: relative; width:100%; font-size:14px; }
        .select-selected {
            height:55px; border:2px solid var(--green); border-radius:12px;
            display:flex; align-items:center; gap:12px; padding:0 15px;
            cursor:pointer; user-select:none; background:#fff; box-sizing:border-box;
            position:relative;
        }
        .select-selected img { width:32px; height:32px; border-radius:50%; object-fit:cover; }
        .select-selected .text { flex:1; color:#222; }
        .select-selected::after{
            content: ""; position: absolute; right: 15px; top: 50%;
            transform: translateY(-50%); width: 0; height: 0;
            border-left: 6px solid transparent; border-right: 6px solid transparent;
            border-top: 6px solid #333;
        }
        .custom-select.open .select-selected::after{ border-top: none; border-bottom: 6px solid #333; }
        .select-items {
            position: absolute; top: calc(100% + 8px); left: 0; right: 0;
            background:#fff; border:2px solid var(--green); border-radius:12px;
            overflow:hidden; z-index:20; box-sizing:border-box; max-height:280px;
            overflow-y:auto; display:none;
        }
        .select-items.show { display:block; }
        .select-items div {
            display:flex; align-items:center; gap:12px; padding:12px 15px;
            cursor:pointer; white-space:nowrap;
        }
        .select-items div:hover { background:#f6f6f6; }
        .select-items img { width:36px; height:36px; border-radius:50%; object-fit:cover; }
        /* ===== Schedule Transaction block (omitted for brevity) ===== */
        .toggle-container { border:2px solid var(--green); border-radius:12px; padding:12px; box-sizing:border-box; }
        .toggle {
            display:flex; align-items:center; justify-content:space-between;
            font-weight:700; margin-bottom:10px; padding: 0 6px;
        }
        .switch { position:relative; width:44px; height:24px; }
        .switch input { opacity:0; width:0; height:0; }
        .slider {
            position:absolute; inset:0; background:#dcdcdc;
            border-radius:34px; transition:.2s;
        }
        .slider:before {
            content:""; position:absolute; height:18px; width:18px;
            left:3px; top:3px; background:#fff; border-radius:50%;
            transition:.2s; box-shadow:0 1px 2px rgba(0,0,0,0.08);
        }
        .switch input:checked + .slider { background: var(--green); }
        .switch input:checked + .slider:before { transform: translateX(20px); }
        .minutes-select { display:none; margin-top:6px; }
        .minutes-inner {
            border:2px solid var(--green); border-radius:12px; height:55px;
            display:flex; align-items:center; padding:0 12px;
            box-sizing:border-box; background:#fff;
        }
        .minutes-inner select {
            width:100%; border:none; outline:none; background:transparent;
            font-size:16px; -webkit-appearance:none; appearance:none;
            cursor:pointer; color:#222;
        }
        
        /* ------------------ NEW SUCCESS SCREEN STYLES ------------------ */
        .success-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: #fff; z-index: 100; display: none; /* Initially hidden */
            flex-direction: column; align-items: center; text-align: center;
        }
        .success-header {
            display: flex; align-items: center; width: 100%;
            padding: 15px; justify-content: space-between;
            font-weight: bold; font-size: 16px;
        }
        .success-header .close-btn { font-size: 24px; cursor: pointer; padding: 0 10px; }
        .success-content {
            flex-grow: 1; padding: 20px; display: flex;
            flex-direction: column; align-items: center;
        }
        .check-circle {
            width: 150px; height: 150px; border-radius: 50%;
            background: var(--light-green); display: flex;
            align-items: center; justify-content: center;
            margin-bottom: 30px; border: 5px solid var(--light-green);
        }
        .check-circle-inner {
            width: 130px; height: 130px; border-radius: 50%;
            background: var(--green); display: flex;
            align-items: center; justify-content: center;
        }
        .check-circle-inner svg {
            width: 70px; height: 70px; fill: #fff;
        }
        .success-message {
            font-size: 18px; font-weight: 500; color: #333;
            margin-top: 10px;
        }
        .success-box {
            width: 90%; max-width: 400px; border: 1px solid #f0f0f0;
            padding: 15px; margin-top: 20px; border-radius: 8px;
            min-height: 150px; position: relative;
        }
        .success-box .ad-placeholder {
            position: absolute; bottom: 10px; left: 50%;
            transform: translateX(-50%); color: #aaa; font-size: 12px;
        }
        .success-button {
            width: 90%; max-width: 400px; height: 50px;
            background: var(--blue); color: #fff; border: none;
            border-radius: 8px; font-size: 16px; margin-top: auto;
            margin-bottom: 20px; cursor: pointer;
        }

        /* ------------------ NEW LOADING POPUP STYLES ------------------ */
        .loading-popup {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.5); z-index: 101; /* Higher z-index than success screen */
            display: none; /* Initially hidden */
            align-items: center; justify-content: center;
        }
        .loading-content {
            background: #fff; padding: 30px 40px; border-radius: 10px;
            text-align: center; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .spinner {
            border: 4px solid #f3f3f3; border-top: 4px solid var(--green);
            border-radius: 50%; width: 30px; height: 30px;
            animation: spin 1s linear infinite; margin: 0 auto 15px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="header">
        <a href="#">&lt; Add Money</a>
        <span class="continue" id="continueButton">Continue</span>
    </div>
    <div class="container" id="mainForm">
        <div class="form-group">
            <label>Amount</label>
            <input id="amount" type="text" placeholder="Input The Amount">
        </div>
        <div class="form-group">
            <label>Account Number</label>
            <input id="acct" type="text" placeholder="Input Sender Account Number">
        </div>
        <div class="form-group">
            <label>Sender Name</label>
            <input id="sender" type="text" placeholder="Input Sender Name">
        </div>
        <div class="form-group">
            <label>Bank Name</label>
            <div class="custom-select" id="bankSelect">
                <div class="select-selected" tabindex="0" aria-haspopup="listbox" role="button">
                    <img id="selectedLogo" src="https://i.ibb.co/vq4t5PS/palmpay.png" alt="Palmpay">
                    <div class="text" id="selectedText" data-bank-name="Palmpay Bank">Palmpay Bank</div>
                </div>
                <div class="select-items" id="bankItems" role="listbox" aria-label="Banks">
                    <div data-value="Palmpay Bank">
                        <img src="https://i.ibb.co/vq4t5PS/palmpay.png" alt="Palmpay logo">
                        <div>Palmpay Bank</div>
                    </div>
                    <div data-value="Opay Bank">
                        <img src="https://i.ibb.co/vXtcz4f/opay.png" alt="Opay logo">
                        <div>Opay Bank</div>
                    </div>
                    <div data-value="Access Bank">
                        <img src="https://i.ibb.co/ZV1h7x5/access.png" alt="Access logo">
                        <div>Access Bank</div>
                    </div>
                    <div data-value="Moniepoint">
                        <img src="https://i.ibb.co/QQb5t2q/moniepoint.png" alt="Moniepoint logo">
                        <div>Moniepoint</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="form-group">
            <label>Note</label>
            <input id="note" type="text" placeholder="Input Narration">
        </div>
        <div class="toggle-container">
            <div class="toggle">
                <span>Schedule Transaction</span>
                <label class="switch">
                    <input type="checkbox" id="scheduleToggle" aria-label="Schedule transaction toggle">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="minutes-select" id="minutesSelect">
                <div class="minutes-inner">
                    <select id="minutesDropdown" aria-label="Select minutes"></select>
                </div>
            </div>
        </div>
    </div>

    <div class="loading-popup" id="loadingPopup">
        <div class="loading-content">
            <div class="spinner"></div>
            <div id="loadingMessage">Adding Funds...</div>
        </div>
    </div>

    <div class="success-overlay" id="successScreen">
        <div class="success-header">
            <span class="close-btn" id="closeSuccess">&times;</span>
            <span>Create Notification Successful</span>
            <span></span>
        </div>
        <div class="success-content">
            <div class="check-circle">
                <div class="check-circle-inner">
                    <svg viewBox="0 0 52 52" xmlns="http://www.w3.org/2000/svg">
                        <path d="M41.7 13.3L21.3 33.7l-9.4-9.4" stroke-width="6" stroke="#fff" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
            </div>
            <div class="success-message">Your notification has been processed</div>
            <div class="success-box">
                <div class="ad-placeholder">[Ad] (Simulated Ad Placeholder)</div>
            </div>
            <button class="success-button" id="successDoneBtn">Done</button>
        </div>
    </div>
    
    <script>
        // --------------- DOM Elements & Constants ---------------
        const customSelect = document.getElementById('bankSelect');
        const selected = customSelect.querySelector('.select-selected');
        const items = document.getElementById('bankItems');
        const selectedText = document.getElementById('selectedText');
        const selectedLogo = document.getElementById('selectedLogo');
        const toggle = document.getElementById('scheduleToggle');
        const minutesSelect = document.getElementById('minutesSelect');
        const minutesDropdown = document.getElementById('minutesDropdown');
        const continueButton = document.getElementById('continueButton');
        const amountInput = document.getElementById('amount');
        const senderInput = document.getElementById('sender');
        const acctInput = document.getElementById('acct');
        
        const loadingPopup = document.getElementById('loadingPopup');
        const successScreen = document.getElementById('successScreen');
        const closeSuccessBtn = document.getElementById('closeSuccess');
        const successDoneBtn = document.getElementById('successDoneBtn');
        const opayIconUrl = "https://i.ibb.co/vXtcz4f/opay.png";

        // --------------- UI Functions ---------------

        // Toggles the visibility of the loading popup
        function toggleLoading(show) {
            loadingPopup.style.display = show ? 'flex' : 'none';
        }

        // Shows the success screen after processing is complete
        function showSuccessScreen() {
            successScreen.style.display = 'flex';
        }

        // Resets the UI by hiding the success screen
        function resetUI() {
            successScreen.style.display = 'none';
        }
        
        // Handlers for closing the success screen
        closeSuccessBtn.addEventListener('click', resetUI);
        successDoneBtn.addEventListener('click', resetUI);

        // --------------- Bank Dropdown Logic (omitted for brevity) ---------------
        function toggleBankList(e) { e.stopPropagation(); customSelect.classList.toggle('open'); items.classList.toggle('show'); }
        selected.addEventListener('click', toggleBankList);
        selected.addEventListener('keydown', (ev) => { if (ev.key === 'Enter' || ev.key === ' ') { ev.preventDefault(); toggleBankList(ev); } });
        items.querySelectorAll('div').forEach(div => {
            div.addEventListener('click', function(e){
                const name = this.dataset.value || this.textContent.trim();
                const img = this.querySelector('img').src;
                selectedText.textContent = name;
                selectedText.dataset.bankName = name; 
                selectedLogo.src = img;
                items.classList.remove('show');
                customSelect.classList.remove('open');
            });
        });
        document.addEventListener('click', function(e){
            if (!customSelect.contains(e.target)) { items.classList.remove('show'); customSelect.classList.remove('open'); }
        });
        document.addEventListener('keydown', function(ev){
            if (ev.key === 'Escape') { items.classList.remove('show'); customSelect.classList.remove('open'); }
        });

        // --------------- Minutes Dropdown Logic (omitted for brevity) ---------------
        for (let i = 1; i <= 60; i++) {
            const opt = document.createElement('option');
            opt.value = i;
            opt.textContent = i === 1 ? `${i} Minute` : `${i} Minutes`;
            minutesDropdown.appendChild(opt);
        }
        minutesDropdown.value = "1";
        toggle.addEventListener('change', function(){
            minutesSelect.style.display = this.checked ? 'block' : 'none';
        });

        // --------------- Notification Logic ---------------
        
        // Reusable function to create the actual Notification
        function createOpayNotification(amount, sender) {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
            
            const options = {
                body: `Credit Alert!\nAmount: ${amount}\nSender: ${sender}\nAcct: ${acctInput.value}\nTime: ${timeString}`,
                icon: opayIconUrl,
                tag: 'opay-credit-alert',
                vibrate: [200, 100, 200]
            };

            new Notification(
                `Opay Bank • ${timeString}`, 
                options
            );
        }

        // Function to request permission and send the notification immediately
        function sendImmediateNotification(amount, sender) {
            if (!("Notification" in window)) {
                alert("This browser does not support desktop notifications.");
                return;
            }

            if (Notification.permission === "granted") {
                createOpayNotification(amount, sender);
            } else if (Notification.permission !== "denied") {
                Notification.requestPermission().then(permission => {
                    if (permission === "granted") {
                        createOpayNotification(amount, sender);
                    } else {
                        console.log("Notification permission denied.");
                    }
                });
            } else {
                 console.log("Notification permission permanently denied.");
            }
        }
        
        /**
         * Function to schedule the notification after a delay.
         */
        function scheduleDelayedNotification(amount, sender, minutes) {
            if (!("Notification" in window)) {
                alert("This browser does not support desktop notifications.");
                return;
            }
            
            const delayInMilliseconds = minutes * 60 * 1000;

            if (Notification.permission !== "granted") {
                Notification.requestPermission().then(permission => {
                    if (permission === "granted") {
                        setTimeout(() => { createOpayNotification(amount, sender); }, delayInMilliseconds);
                    } else {
                        console.log("Notification permission denied.");
                    }
                });
            } else {
                setTimeout(() => { createOpayNotification(amount, sender); }, delayInMilliseconds);
            }
            
            alert(`Transaction scheduled for ${minutes} minute(s). The notification will drop then.`);
        }

        // --------------- Main Execution Logic on Continue Click ---------------

        continueButton.addEventListener('click', function(e) {
            e.preventDefault();
            
            const bankName = selectedText.dataset.bankName;
            const isScheduled = toggle.checked;
            const amount = amountInput.value.trim();
            const sender = senderInput.value.trim();

            // 1. Basic Input Validation
            if (!amount || !sender) {
                alert("Please enter both Amount and Sender Name.");
                return;
            }
            
            // 2. Bank Check
            if (bankName !== 'Opay Bank') {
                alert("Please select Opay Bank to generate a credit notification.");
                return;
            }
            
            // 3. Start Loading Pop-up
            toggleLoading(true);

            // 4. Simulate Network/Processing Time (e.g., 2 seconds)
            const processingTime = 2000; 

            setTimeout(() => {
                // 5. Hide Loading Pop-up
                toggleLoading(false);

                if (isScheduled) {
                    // Delayed Notification
                    const minutes = parseInt(minutesDropdown.value, 10);
                    if (isNaN(minutes) || minutes < 1) {
                         alert("Invalid minute selection for scheduling.");
                         return;
                    }
                    scheduleDelayedNotification(amount, sender, minutes);

                } else {
                    // Immediate Notification
                    sendImmediateNotification(amount, sender);
                }

                // 6. Show Success Screen
                showSuccessScreen();

            }, processingTime);
        });

    </script>
</body>
</html>
